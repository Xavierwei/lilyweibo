/*
 * page base action
 */LP.use(["jquery","api"],function(e,t){var n="api",r=!1;e(document.body).delegate(".step2Styles li","click",function(){var t=e(".step2Styles li"),n=e.inArray(this,t);t.removeClass("on");e(this).addClass("on");e(".step2BtnNext").removeClass("step2BtnNextDisabled");e("#val_type").val(n+1)}).delegate("#val_word","keyup",function(t){var n=e(this).val(),r=n.length;r>15&&e(".step1Error").fadeIn();if(!(r>0&&r<16)){e(".step1BtnNext").addClass("step1BtnNextDisabled");return!1}e(".step1BtnNext").removeClass("step1BtnNextDisabled");e(".step1Error").fadeOut();if(t.which==13){t.preventDefault();LP.triggerAction("submit_word")}});LP.action("submit_word",function(){if(e(this).hasClass("step1BtnNextDisabled"))return!1;e(".step1").fadeOut();e(".step2").delay(510).fadeIn()});LP.action("back_word",function(){e(".step2").fadeOut();e(".step1").delay(510).fadeIn()});LP.action("submit_style",function(){if(e(this).hasClass("step2BtnNextDisabled"))return!1;e(".step_loading").fadeIn();var r={content:e("#val_word").val(),style:e("#val_type").val()};t.ajax("getimage",r,function(t){e(".step_loading").stop().fadeOut();e(".step2").fadeOut();e(".step3").delay(510).fadeIn();e("#step3PreviewImg").attr("src",n+t.image);e("#val_image").val(t.image)},function(){setTimeout(function(){e(".step_loading").stop().fadeOut()},200)})});LP.action("back_style",function(){e(".step3").fadeOut();e(".step2").delay(510).fadeIn()});LP.action("submit_post",function(){e(".step3").fadeOut();e(".step4").delay(510).fadeIn();e(".step_loading").fadeIn();var r={content:e("#val_word").val(),style:e("#val_type").val(),image:e("#val_image").val()};t.ajax("post",r,function(t){e(".step_loading").stop().fadeOut();t.data.image=n+t.data.image;LP.compile("preview-template",t.data,function(t){e("#stepWaitApprove").append(t);e(".stepWaitApprove").fadeIn()})},function(){setTimeout(function(){e(".step_loading").stop().fadeOut()},200)})});LP.action("submit_dmx",function(){if(r)return!1;r=!0;t.ajax("dmx",function(t){r=!1;if(t.error)data={};else{if(t.data.offset>0){t.data.direction="up";t.data.direction_text="上升"}else{t.data.direction="down";t.data.direction_text="下降"}t.data.offset=Math.abs(t.data.offset);data=t.data}LP.compile("popup-dmx-template",data,function(t){e("body").append(t);e("#popup-dmx").fadeIn()});var n=e("#myRank").data("user");n.rank=t.data.newRank;e("#myRank").data("user",n);n.position=parseInt((n.rank-1)/n.total*100);n.total==n.rank&&(n.position=100);LP.compile("myrank-template",n,function(t){e("#myRank").html(t)})})});LP.action("submit_friends",function(){LP.compile("popup-friends-template",{},function(n){e("body").append(n);e("#popupFriends").fadeIn();t.ajax("friends",function(t){var n=Math.ceil(t.data.total_number/8);for(var r=1;r<=n;r++)LP.compile("paginate-template",{pagenum:r},function(t){e("#friendsPaginate").append(t)});e("#friendsPaginate li").eq(0).addClass("on");e("#friendsList").fadeIn().data("friends",t.data.users);var i=t.data.users.slice(),s=i.splice(0,8);e.each(s,function(t,n){LP.compile("friend-item-template",n,function(t){e("#friendsList").append(t)})})})})});LP.action("change_friend_page",function(){var t=e("#friendsPaginate li"),n=e.inArray(this,t),r=e("#friendsList").data("friends").slice(),i=r.splice(n*8,(n+1)*8);t.removeClass("on");e(this).addClass("on");e("#friendsList").fadeOut(function(){e(this).empty();e.each(i,function(t,n){LP.compile("friend-item-template",n,function(t){e("#friendsList").append(t)})});e(this).fadeIn()})});LP.action("searchFriend",function(){var t=e("#friendsList").data("friends"),n=e("#popupFriends .keyword").val();if(!n){e("#friendsPaginate").fadeIn();e("#friendsPaginate li").eq(0).click();return}e("#friendsPaginate").fadeOut();e("#friendsList").fadeOut(function(){e(this).empty();e.each(t,function(t,r){r.screen_name.indexOf(n)!=-1&&LP.compile("friend-item-template",r,function(t){e("#friendsList").append(t)})});e(this).fadeIn()})});LP.action("add_friend",function(){var t=e(this).data("name"),n=e(this).data("snsuid"),r=e("#inviteText"),i;if(e(this).hasClass("selected")){var s=e("#friendsList").data("selected"),o=e.inArray(n,s);s.splice(o,1);e("#friendsList").data("selected",s);i=r.html().replace(" @"+t,"");r.html(i);e(this).removeClass("selected");return}i=r.html()+" @"+t;if(i.length<140){e(this).addClass("selected");r.html(i);var s=e("#friendsList").data("selected");s||(s=[]);s.push(n);e("#friendsList").data("selected",s)}});LP.action("invite_friends",function(){var n=e("#friendsList").data("selected").toString(),r=e("#inviteText").html();t.ajax("invite",{friends:n,sharetext:r});LP.triggerAction("close_popup")});LP.action("weibo_login",function(){if(!e(".stepLoginTerm span").hasClass("checked")){e(".stepLoginError").fadeIn();return!1}var t={url:e(this).data("url")};LP.compile("login-iframe-template",t,function(t){e("body").append(t);e("#weiboLoginForm").fadeIn()})});LP.action("agree_term",function(){var t=e(this).find("span");if(t.hasClass("checked"))t.removeClass("checked");else{t.addClass("checked");e(".stepLoginError").fadeOut()}});LP.action("close_popup",function(){e(".popup").fadeOut(function(){e(this).remove()});e(".overlay").fadeOut(function(){e(this).remove()})});var i=function(){var r={page:1,pagenum:5};t.ajax("list",r,function(t){var n=t.data;e("#totalCountText").html(t.total);e.each(n,function(t,n){LP.compile("list-item-template",n,function(t){e("#list_wrap").append(t)})})},function(){e("#list_wrap").html("加载失败，请刷新页面再试一次。")});t.ajax("myrank",function(t){if(t.error==1001){e(".stepLogin").fadeIn();e(".stepLoginBtn").data("url",t.url)}else{t.data.status==undefined&&e(".step1").fadeIn();switch(t.data.status){case 0:t.data.image=n+t.data.image;LP.compile("preview-template",t.data,function(t){e("#stepWaitApprove").append(t);e(".stepWaitApprove").fadeIn()});break;case 1:if(t.data.rank){e("#myRank").data("user",t.data);e(".step4").fadeIn();e(".steps").addClass("steps_high");t.data.image=n+t.data.image;t.data.position=parseInt((t.data.rank-1)/t.data.total*100);t.data.total==t.data.rank&&(t.data.position=100);LP.compile("myrank-template",t.data,function(t){e("#myRank").append(t)})}break;case 2:break;case 3:t.data.image=n+t.data.image;LP.compile("preview-template",t.data,function(t){e("#stepProduced").append(t);e(".stepProduced").fadeIn()});break;default:}}},function(){e("#list_wrap").html("加载失败，请刷新页面再试一次。")})};i()});